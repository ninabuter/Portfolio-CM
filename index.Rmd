---
title: "Beyoncé's Discography"
output: 
  flexdashboard::flex_dashboard:
    storyboard: TRUE
    orientation: columns 
    theme: yeti
---

# Introduction

```{r, echo = FALSE, include= FALSE}
library(tidyverse)
library(spotifyr)
library(ggplot2)
library(plotly)
library(compmus)
library(flexdashboard)

```

```{r, echo = FALSE, include=FALSE}
DangerouslyInLove <- get_playlist_audio_features("", "3fMQZa4rswBIb9hs6n217m")
BDayDeluxeEdition <- get_playlist_audio_features("", "45P8KBiTPKwVWiFtLGUH1V")
IAmSachaFierce <- get_playlist_audio_features("", "6DOBEbYqJhld4nYXmv2d7Q")
Four <- get_playlist_audio_features("", "5gIFimP3dScVPvhg296hG7")
Beyoncé <- get_playlist_audio_features("", "2zCrPKo2K8KuP7PSCurVJd")
Lemonade <- get_playlist_audio_features("", "1JTaxwfuwmdYNdz2EgSJPz")
TheLionKing <- get_playlist_audio_features("", "2oqUwlwt0bY3nqkpFGrtaS")

```

```{r, echo = FALSE, include=FALSE}
Albums <-
  bind_rows(
    DangerouslyInLove %>% mutate(category = 'Dangerously In Love'),
    BDayDeluxeEdition %>% mutate(category = 'B-Day Deluxe Edition'),
    IAmSachaFierce %>% mutate(category = 'I Am Sacha Fierce'),
    Four %>% mutate(category = '4'),
    Beyoncé %>% mutate(category = 'Beyoncé'),
    Lemonade %>% mutate(category = 'Lemonade'),
    TheLionKing %>% mutate(category = 'The Lion King')
  )
```

***
**DO NOT SHOW THIS IN CLASS** Today, Beyoncé is one of my favorite artists. She has already had a long career and has produced a number of albums, including *Dangerously In Love*, *B-Day*, *I Am Sacha Fierce*, *4*, *Beyoncé*, *Lemonade* and *The Lion King*. One of the reasons I like Beyoncé and her music so much is because she has such a varied style in her albums and that's why I can always rely on her music. On extravagant moments I like to listen to *4*, if I want to listen to old pop classics like Halo, I put on *I Am Sacha Fierce*, and when I'm not feeling well I listen to *Lemonade* for a boost of self-confidence. Because I like Beyoncé's style variation between albums so much, I think it would be nice to research with SpotifyR how her music has developed in recent years. By using SpotifyR audio features acousticness, energy, valence, dancaebility, speechness, and key. To dive a bit deeper in Beyoncé's songs, I would like to compare an earlier song *Halo* with a more recent song *Drunk In Love*. 

# Albums: Their Musical Content 

Column {data-width=500}
------------------------------------------------

### Energy, Valence, Acousticness, and Danceability 

```{r, echo = FALSE}
VaEnAcDa <- ggplot(Albums, aes(x = valence, y = energy, color = acousticness, size = danceability, text=(paste("Track:", track.name, "<br>", 
            "Acousticness:", acousticness, "<br>",
            "Energy:", energy, "<br>",
            "Valence:", valence, "<br>",
            "Danceability:", danceability, "<br>")))) +
  geom_point(alpha = 0.5, size = 2) +
  geom_jitter(alpha = 0.5, width = 0.1) +
  facet_wrap(~category) +
  scale_color_gradient(low = "light blue", high = "black") +
  ggtitle('Beyoncé: Different Albums') +
  xlab("Valence") + ylab("Energy") +
  theme(plot.title = element_text(family = 'Arial', 
                                  face = 'bold', 
                                  size = 15)) +
  theme(legend.title = element_text(family = 'Arial',
                                    face = 'bold',
                                    size = 10)) +
  theme(axis.title = element_text(family = 'Arial',
                                  size = 10)) +
  theme(axis.text.x = element_text(size = 6)) +
  theme(axis.text.y = element_text(size = 6))
  

ggplotly(VaEnAcDa, tooltip=c("text"))
```
***
In the scatterplot, the energy, valence, acousticness, and danceability of Beyoncé's songs are shown. Overall, Beyoncé's songs have an acousticness below 0.5, which means low confidence that the track is acoustic. You can also clearly see the difference between Beyoncé's albums *Dangerously In Love*, *B-Day Deluxe Edition*, and *4* in valence compared to the other albums. The former have a higher valence than the other albums. 

Column {data-width=500}
-----------------------------------

### Speechiness 

```{r, echo = FALSE}
green <- "#1ed760"
yellow <- "#e7e247"
pink <- "#ed00d9"
blue <- "#17bebb"
orange <- "#eba834"
red <- "#ed0000"
purple <- "#8e00ed"
```

```{r, echo = FALSE}

Albums2 <- Albums%>%
  mutate(difference=speechiness-0.33)


Speechness <- ggplot(Albums2, aes(x=reorder(track.name, difference), y=difference, fill=playlist_name, text=(paste("Track:", track.name, "<br>",
                                      "Speechiness:", speechiness))))+
  geom_col()+
  scale_fill_manual(values=c(green, yellow, pink, blue, orange, red, purple))+
  theme_minimal()+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.ticks.y=element_blank(),
        panel.grid.major = element_blank(),
        legend.position="none")+
  ylab("Speechiness Difference")+
  facet_wrap(~ playlist_name)+
  ggtitle("Speechiness Difference") +
    theme(plot.title = element_text(family = 'Arial', 
                                  face = 'bold', 
                                  size = 15)) +
    theme(axis.title = element_text(family = 'Arial'))

ggplotly(Speechness, tooltip=c("text"))

```
***
I wanted to research speechiness, a.k.a. the presence of spoken words, in Beyoncé's songs. According to Spotify, values between 0.33 and 0.66 describe tracks that both contain music and speech, values above 0.66 describe tracks that are probably made entirely of spoken words, and tracks with values below 0.33 most likely contain music and other non-speech-like sounds. Based on the values, the differences between the speechiness scores and 0.33 are used, so the emphasis lies on rap songs vs. more instrumental songs.  If the difference is above 0, the song probably consists (almost) entirely of spoken words. And the lower the values below 0, the less spoken words the songs contain. 
Now that I've run the code, I see that Beyoncé primarily has a speechiness value below 0.66. That's why I'm thinking of changing the code so that values below 0.66 are more emphasized instead of values above 0.66.


### Key

```{r, echo = FALSE,include= FALSE}
KeyTable <- Albums%>%
  select(playlist_name, key)%>%
  group_by(playlist_name, key)%>%
  mutate(n=n())%>%
  unique()%>%
  group_by(key)%>%
  mutate(total=sum(n))%>%
  mutate(percent=round((n/total)*100))

head(KeyTable, 10)

```

```{r, echo = FALSE}
Toonsoort <- c('C', 'C#/Db', 'D', 'D#/Eb', 'E', 'F', 'F#/Gb', 'G', 'G#/Ab', 'A', 'A#/Bb', 'B')
KeyTable <- KeyTable%>%
  mutate(key2 = Toonsoort[key+1])
  
```

```{r, echo = FALSE}
KeyAlbums <- ggplot(KeyTable, aes(x=key2, fill=playlist_name, y = n, 
                                text = paste("Number of Songs: ", n, "<br>",
                                            "Percent Songs in Key: ", percent, "%")))+
  geom_bar(width=0.5, stat = "identity")+
  scale_x_discrete(limits = Toonsoort) +
  scale_fill_manual(values=c(green, yellow, pink, blue, orange, red, purple))+
  labs(x="Key", y="Percent of Songs")+
  guides(fill=guide_legend(title="Playlist"))+
  theme_minimal()+
  ggtitle("Musical Key Percentage by Playlist") +
  theme(plot.title = element_text(family = 'Arial', 
                                  face = 'bold', 
                                  size = 15)) +
  theme(axis.title = element_text(family = 'Arial')) +
  theme(legend.title = element_text(family = 'Arial',
                                    face = 'bold',
                                    size = 10))

ggplotly(KeyAlbums, tooltip=c("text"))
```
***
I created this graph because I thought it would tell a lot about the albums. The graph shows that Beyoncé key variation in her songs and albums.


# Halo vs. Drunk In Love

Column {data-width=500}
--------------------------------

### Halo

```{r, echo = FALSE}
Helo <-
  get_tidy_audio_analysis("2CvOqDpQIMw69cCzWqr5yr") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r, echo = FALSE}
Helo %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  ggtitle('Song: Helo') +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
***

Column {data-width=500}
-------------------------------------

### Drunk In Love

```{r, echo = FALSE}
DrunkInLove <-
  get_tidy_audio_analysis("6jG2YzhxptolDzLHTGLt7S") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r, echo = FALSE}
DrunkInLove %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  ggtitle('Song: Drunk In Love') +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```
***